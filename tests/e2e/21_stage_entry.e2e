# Test: agents walk INTO the StageFloor ring, not just stop at the edge
# Verifies agents reach their assigned spots deep inside the yellow zone

reset_game
set_spawn_enabled 0
set_agent_speed 8
wait_frames 5

# Build a path from gate area straight to the stage floor ring
draw_path_rect 1 25 24 28
wait_frames 2

# Screenshot 1: empty stage area before agents
screenshot 21_stage_before

# Spawn 10 agents at the gate, all heading to stage
spawn_agents 1 26 10 stage
wait_frames 2

# Wait for agents to walk ~25 tiles at high speed
wait 12

# Screenshot 2: agents should be entering the stage floor area
screenshot 21_stage_entering

# Wait more for agents to reach their targets deep inside
wait 12

# Screenshot 3: agents should be spread inside the yellow ring
screenshot 21_stage_inside

# Assert: at least 5 agents should be standing ON StageFloor tiles
assert_agents_on_tiletype stagefloor >= 5

# Assert: at least 2 agents should have WatchingStage component
# (some may still be walking to their random target spot)
assert_agent_watching >= 2

# Assert: agents are near the stage center (within watch radius)
assert_agent_near 32 27 8

# Final screenshot showing agents inside the ring
screenshot 21_stage_final

# --- Part 2: agents from the OTHER side of the stage ---
# Spawn agents that need to route AROUND the stage building

spawn_agents 40 27 5 stage
wait 15

# These agents should also be on StageFloor tiles after routing around
screenshot 21_stage_routed
assert_agents_on_tiletype stagefloor >= 7
